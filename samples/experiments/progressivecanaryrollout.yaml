apiVersion: iter8.tools/v1alpha1
kind: Version
metadata:
  name: baseline
  spec:
    supportingResources:
    - kind: InferenceService
      name: sklearn-iris.kfserving-test.svc.cluster.local
    tags:
      storageUri: gs://kfserving-samples/models/tensorflow/flowers
---
apiVersion: iter8.tools/v1alpha1
kind: Version
metadata:
  name: candidate
  spec:
    supportingResources:
    - kind: InferenceService
      name: sklearn-iris.kfserving-test.svc.cluster.local
    tags:
      storageUri: gs://kfserving-samples/models/tensorflow/flowers-2
    weightFieldPath: spec.supportingResources[0]/spec.canaryTrafficPercent
---
apiVersion: iter8.tools/v1alpha3
kind: Experiment
metadata:
  name: sklearn-iris-experiment-12
spec:
  targetKey: sklearn-iris
  inferenceServiceRef: modelnamespace/sklearn-iris
  canarySpec:
    predictor:
      tensorflow:
        storageUri: gs://kfserving-samples/models/tensorflow/flowers-2
  criteria:
    indicators:
    - 95th_percentile_tail_latency
    - container_throttled_seconds_total
    objectives:
    - metric: mean_latency
      upperLimit: 200
    - metric: error_rate
      upperLimit: 0.01
  duration:
    interval: 20s
    maxIterations: 8
  handlers:
    setup: setup.iter8-kfserving.svc.cluster.local
    finish: finish.iter8-kfserving.svc.cluster.local
  notifications:
    end:
    - https://end.listener
    postIteration:
    - https://iteration.listerner
    start:
    - https://start.lisetener